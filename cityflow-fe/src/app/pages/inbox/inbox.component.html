<div class="chat-container font-manrope rounded-[10px] space-x-3">
  <div class="user-list-section rounded-[10px]">
    <div class="user-search border-white text-blueGray/10 rounded-[10px] mt-3 mr-2 ml-2">
      <input type="text" [(ngModel)]="nameFilter" (ngModelChange)="searchUsersByName()"
        placeholder="Search users by name" class="rounded-[10px]">
      <fa-icon [icon]="faSearch" class="search-icon text-blueGray/20"></fa-icon>
    </div>
    <div class="user-list">
      <ng-container *ngIf="nameFilter; else showPartners">
        <div *ngFor="let user of chatUsers" class="user-item" (click)="selectUser(user)">
          <img *ngIf="userImages.get(user.id)" [src]="userImages.get(user.id)" alt="{{ user.name }}">
          <div>
            <span>{{ user.name }} {{ user.lastname }}</span>
          </div>
        </div>
      </ng-container>
      <ng-template #showPartners>
        <div *ngFor="let partner of communicationPartners" 
        (click)="selectUser(partner.user)" 
        class="user-item cursor-pointer " 
        [class.bg-opacity-30]="partner.hasUnreadMessages"
        [class.bg-[#E8BC81]]="partner.hasUnreadMessages"
        [class.text-gray-400]="partner.hasUnreadMessages">
          <img *ngIf="userImages.get(partner.user.id)" [src]="userImages.get(partner.user.id)" alt="{{ partner.user.name }}" class=" border-blueGray/70 border-[1px]">
          <div>
            <span [ngClass]="{'font-bold': partner.hasUnreadMessages}">{{ partner.user.name }} {{ partner.user.lastname }}</span>
            <p>{{ partner.lastMessage.content | slice:0:30 }}...</p>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="message-area rounded-[10px] shadow-lg">
    <div *ngIf="selectedUser" class="user-info rounded-[10px] shadow-lg">
      <img *ngIf="userImages.get(selectedUser.id)" [src]="userImages.get(selectedUser.id)" alt="{{ selectedUser.name }}"
        class="user-avatar  border-[1px] border-blueGray/70">
      <div class="user-details">
        <span>{{ selectedUser.name }} {{ selectedUser.lastname }} ({{ getRoleDisplayName(selectedUser.roles) }})</span>
      </div>
    </div>
    
    <div class="messages ">
      <div *ngFor="let message of messages; let i = index" class="mb-4">
        <div [ngClass]="{'message': true, 'mine': message.senderId === loggedUser.id, 'theirs': message.senderId !== loggedUser.id}">
          {{ message.content }}
        </div>
        <div *ngIf="message.senderId === loggedUser.id && i === messages.length - 1" class="flex justify-end text-xs text-blueGray/50">
          <fa-icon [icon]="message.readStatus ? faCheckDouble : faCheck" 
                   [ngClass]="{'text-blue-500': message.readStatus, 'text-blueGray/50': !message.readStatus}" class="text-xs"></fa-icon>
          <fa-icon [icon]="message.readStatus ? faCheckDouble : faCheck" 
                   [ngClass]="{'text-blue-500': message.readStatus, 'text-blueGray/50': !message.readStatus}" class="text-xs"></fa-icon>
          <span class="ml-1">{{ message.readStatus ? 'Read' : 'Delivered' }}</span>
        </div>
      </div>
    </div>
    <div class="flex flex-row w-full p-2 rounded-md gap-4 items-center">
      <div class="flex flex-row w-[95%] h-auto">
        <textarea
          class="placeholder:italic flex w-full bg-blueGray/5 text-[#1f2630] p-2 shadow-lg border border-[#e4e4e7] rounded-[10px] max-h-[100px] min-h-[60px] h-[60px]"
          [(ngModel)]="newMessageContent" placeholder="Enter your message here..."></textarea>
      </div>
      <div
        class="flex rounded-full size-[50px] bg-[#4CD137] text-[#ffffff] items-center justify-center p-4 cursor-pointer hover:bg-[#049f21] transition-[0.5s]"
        (click)="sendMessage()">
        <fa-icon [icon]="faPaperPlane" class="text-[24px]"></fa-icon>
      </div>
    </div>
  </div>
</div>