<div *ngIf="formOpen" class="flex items-center justify-center min-h-screen relative z-[1]  font-manrope">

  <div class="flex flex-col rounded-[10px] bg-white p-2 pb-6 shadow-2xl w-[600px] items-center justify-center relative  font-manrope">

    <form #newShiftForm="ngForm" (ngSubmit)="addShift(newShiftForm)">
      <div class="flex flex-col items-center justify-center w-full pt-4">
        <p class="text-darkGray font-manrope font-semibold text-[35px]">Add New Shift</p>
      </div>
      <div class="flex flex-col w-full">
        <div class="flex flex-col font-manrope font-regular text-darkGray">
          <button type="button" (click)="toggleUserModal()"
            class="w-[444px] h-[60px] font-manrope font-semibold text-blueGray rounded-[10px] shadow-lg border border-[#e4e4e7] bg-white hover:bg-darkGrey/5 transition-[0.5s] my-3">
            {{ selectedUser ? (selectedUser.name + ' ' + selectedUser.lastname) : 'Select User' }}
          </button>

          <div *ngIf="userModalOpen" class="fixed inset-0 flex items-center justify-center absolute z-[10]">
            <div class="bg-white rounded-[10px] w-full h-full overflow-auto shadow-2xl ">
              <div class="border-b p-4 flex justify-between items-center">
                <span class="text-lg font-semibold text-darkGrey">Select a User</span>
                <button (click)="toggleUserModal()">
                  <fa-icon [icon]="faX" class="pr-1 text-[21px] text-darkGray hover:text-darkGrey/60" />
                </button>
              </div>
              <ul class="list-none p-2 space-y-2">
                <li *ngFor="let user of users$ | async" (click)="selectUser(user)"
                  class="flex items-center space-x-2 cursor-pointer p-2 hover:bg-lightGrey/10">
                  <img *ngIf="userImages.get(user.id)" [src]="userImages.get(user.id)" [alt]="user.name"
                    class="h-10 w-10 rounded-full object-cover shadow-lg">
                  <div *ngIf="!userImages.get(user.id)"
                    class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center text-white">N/A</div>
                  <div>{{ user.name }} {{ user.lastname }} - {{ user.roles }}</div>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div *ngIf="busModalOpen" class="fixed inset-0 flex items-center justify-center absolute z-[10]">
          <div class="bg-white rounded-[10px] w-full h-full overflow-auto shadow-2xl ">
            <div class="border-b p-4 flex justify-between items-center">
              <span class="text-lg font-semibold text-darkGrey">Select a Bus</span>
              <button (click)="toggleBusModal()">
                <fa-icon [icon]="faX" class="pr-1 text-[21px] text-darkGray hover:text-darkGrey/60" />
              </button>
            </div>
            <ul class="list-none p-2 space-y-2">
              <li *ngFor="let bus of buses$ | async" (click)="selectBus(bus)"
                class="flex items-center space-x-2 text-darkGray p-2 hover:bg-lightGrey/10 hover:cursor-pointer">
                <div>{{ bus.licencePlate }}</div>
              </li>
            </ul>
          </div>
        </div>

        <button (click)="toggleBusModal()" type="button"
          class="w-[444px] h-[60px] font-manrope font-semibold text-blueGray rounded-[10px] shadow-lg border border-[#e4e4e7] bg-white hover:bg-darkGrey/5 transition-[0.5s] my-3">
          {{ selectedBus ? selectedBus.licencePlate : 'Select Bus' }}
        </button>

        <div *ngIf="locationModalOpen" class="fixed inset-0 flex items-center justify-center absolute z-[10]">
          <div class="bg-white rounded-[10px] w-full h-full shadow-2xl p-4">
            <div class="border-b flex justify-between items-center">
              <span class="text-lg font-semibold text-darkGrey">Select a Location</span>
              <button (click)="toggleLocationModal()">
                <fa-icon [icon]="faX" class="pr-1 text-[21px] text-darkGray hover:text-darkGrey/60" />
              </button>
            </div>
            <div #mapContainer class="h-[580px] w-full p-2"></div>
            <button (click)="confirmLocation()"
              class="w-full h-[60px] font-manrope mt-4 font-semibold text-white rounded-[10px] bg-lightGreen hover:bg-deepGreen transition-[0.5s]">
              Confirm Location
            </button>
          </div>
        </div>

        <button (click)="toggleLocationModal()" type="button"
          class="w-[444px] h-[60px] font-manrope font-semibold text-blueGray rounded-[10px] shadow-lg border border-[#e4e4e7] bg-white hover:bg-darkGrey/5 transition-[0.5s] my-3">
          {{ selectedLocation || 'Select Location' }}
        </button>

        <div class="flex flex-col w-full items-center">
          <p class="text-blueGray font-manrope font-semibold text-[18px] mt-4 mb-2">Select Date And Extra Hours</p>
          <div class="flex flex-row w-full gap-4 justify-center">
            <div class="flex flex-col w-[213px]">
              <div class="flex flex-col font-manrope items-center text-white ">
                <input type="datetime-local" id="startTime" name="startTime" [(ngModel)]="newShift.startTime"
                  class="w-full h-[50px] shadow-lg border border-[#e4e4e7] rounded-[10px] px-2 py-4 text-blueGray"
                  placeholder="Start Time">
              </div>
            </div>
            <div class="flex flex-col w-[213px]">
              <div class="flex flex-col font-manrope font-regular items-center text-white ">
                <input type="number" id="extraHours" name="extraHours" [(ngModel)]="newShift.extraHours"
                  class="rounded-[10px] w-full h-[50px] shadow-lg border border-[#e4e4e7] bg-white px-2 py-4 text-blueGray"
                  placeholder="Extra Hours">
              </div>
            </div>
          </div>
        </div>
        
        <div class="flex flex-col font-manrope font-regular text-blueGray mt-5 items-center">
          <p class="text-darkGray font-manrope font-semibold text-[18px]">Select Days of the Week</p>
          <div class="grid grid-cols-4 justify-between gap-4 mt-2 justify-center">
            <div *ngFor="let day of daysOfWeek" (click)="toggleDaySelection(day)"
              [ngClass]="{'bg-darkBusYellow/80 text-white': isDaySelected(day), 'bg-white text-blueGray': !isDaySelected(day)}"
              class="cursor-pointer shadow-lg border border-[#e4e4e7] w-[100px] h-[50px] flex items-center justify-center rounded-[10px] transition-[0.5s] hover:bg-darkGrey/5">
              {{ day }}
            </div>
          </div>
        </div>
        
      </div>
      <div class="flex flex-row gap-2 items-center">
        <button type="submit" class="w-[444px] h-[60px] font-manrope font-semibold text-white rounded-[10px] 
            bg-lightGreen hover:bg-deepGreen transition-[0.5s] my-4">
          Add Shift
        </button>
      </div>
    </form>
  </div>
</div>